**优先级路线图**
- 目标顺序：先交付最小可演示（Dashboard统计+最新列表），再按实时、查询、配置、分布式、AI逐步扩展（参考 `kango-\docs\FUNCTIONAL_DESIGN_SUMMARY.md:101-110`）。

**阶段1｜最小可演示（MVP）**
- 模块
  - 核心业务：事件落盘（NDJSON）、基础统计汇总（`FUNCTIONAL_DESIGN_SUMMARY.md:58-60`）。
  - 数据层：初始化数据与汇总文件、按日滚动结构（`FUNCTIONAL_DESIGN_SUMMARY.md:61-63`）。
  - 应用服务层：REST读取统计与最新事件（`FUNCTIONAL_DESIGN_SUMMARY.md:55`）。
  - 前端：Dashboard页展示指标卡+最新N条（`FUNCTIONAL_DESIGN_SUMMARY.md:87-90`）。
- 接口
  - `GET /api/v1/stats`（总数、按级别/类型分布、最后检测时间；对齐接口规范）。
  - `GET /api/v1/events?page=1&size=10&sort=detected_at:desc`（最新N条事件；统一分页与排序）。
- 数据文件
  - `data/anomalies.ndjson`、`data/summary.json`（`FUNCTIONAL_DESIGN_SUMMARY.md:61-64`）。

**阶段2｜实时推送（SSE）**
- 模块
  - 文件尾部监听/`journalctl -f`近实时捕获（`FUNCTIONAL_DESIGN_SUMMARY.md:15`）。
  - SSE服务：增量事件推送、断线重连与心跳（`FUNCTIONAL_DESIGN_SUMMARY.md:13`，`FUNCTIONAL_DESIGN_SUMMARY.md:56`，`FUNCTIONAL_DESIGN_SUMMARY.md:106`）。
  - 前端：订阅SSE、自动刷新与去重。
- 接口
  - `GET /api/v1/stream`（`text/event-stream`，事件含`id/type/severity/message/detected_at/host_id`，支持`Last-Event-ID`断线重连）。

**阶段3｜历史查询与详情**
- 模块
  - REST流式过滤NDJSON、分页返回（`FUNCTIONAL_DESIGN_SUMMARY.md:83`）。
  - 前端 History 页：时间范围/级别/关键词筛选、分页与详情（`FUNCTIONAL_DESIGN_SUMMARY.md:92-99`）。
- 接口
  - `GET /api/v1/events?start&end&severity&types&keyword&host_id&page&size&sort`（流式过滤与分页）。
  - `GET /api/v1/events/{id}`（事件详情）。

**阶段4｜配置管理**
- 模块
  - 配置读取/校验/更新、保留策略按天清理（`FUNCTIONAL_DESIGN_SUMMARY.md:71-72`，`FUNCTIONAL_DESIGN_SUMMARY.md:105`）。
  - 前端 Settings 页：检测路径、扫描间隔、保留天数、显示与通知（`FUNCTIONAL_DESIGN.md:229-261`）。
- 接口
  - `GET /api/v1/config`、`PUT /api/v1/config`（JSON schema校验与错误码约定）。

**阶段5｜分布式 Agent 与聚合**
- 模块
  - Agent：各主机实时监听命中规则后批量上报（含`host_id`与鉴权；`FUNCTIONAL_DESIGN_SUMMARY.md:66`，`FUNCTIONAL_DESIGN.md:75-79`）。
  - Aggregator：接收、合并、落盘、更新汇总与推送（`FUNCTIONAL_DESIGN_SUMMARY.md:67-70`）。
- 接口
  - `POST /api/v1/ingest`（`Authorization: Bearer <token>`；事件数组，批量`<=100`，去重与速率限制按规范）。
  - `GET /api/v1/hosts/stats`（主机维度统计）。

**阶段6｜AI分析与建议**
- 模块
  - 事件筛选、语义摘要、知识检索、建议生成与风险标注、短期缓存（`FUNCTIONAL_DESIGN_SUMMARY.md:74-79`）。
  - 前端详情与Dashboard显示AI建议（`FUNCTIONAL_DESIGN_SUMMARY.md:79`）。
- 接口
  - `GET /api/v1/ai/suggestions?window&types&host_id&limit`（至少3类异常给出解释与建议）。

**阶段7｜告警通知与导出/趋势**
- 模块
  - 邮件通知、静默期、严重异常立即通知（`FUNCTIONAL_DESIGN.md:247-252`）。
  - CSV导出、趋势图与统计每30–60秒更新（`FUNCTIONAL_DESIGN_SUMMARY.md:94-95`，`FUNCTIONAL_DESIGN_SUMMARY.md:108`）。
- 接口
  - `GET /api/v1/stats` 扩展含趋势数据与类型/级别分布（与阶段1同接口，丰富字段）。
  - CSV导出为可选扩展，启用时将按接口规范追加定义。

**实现提示**
- 统一事件Schema与时间格式（ISO8601），枚举`type/severity`，`host_id`为主机权威标识（`FUNCTIONAL_DESIGN_SUMMARY.md:69`）。
- 接口版本化与兼容：加`/api/v1`前缀；响应包含`schema_version`，变更走日志。
 - SSE稳定性：事件类型`anomaly`与`ping`心跳；支持`Last-Event-ID`重连定位；退避与速率上限按规范。
- 保留策略与按日滚动：与汇总更新节奏对齐（`FUNCTIONAL_DESIGN_SUMMARY.md:62-63`）。
 - 事件去重与ID：基于`id`与(`host_id`,`source_file`,`line_number`,`detected_at`)组合；`id`建议sha256前16位。
 - 鉴权与配额：`POST /api/v1/ingest`强制Bearer令牌；每主机`<=1000`事件/分钟，单次批量`<=100`。
 - 分页与排序：统一`page/size/sort`，返回`total/has_next`；支持多值`severity/types`与`host_id`过滤。
 - 对齐文档：详细字段与约束参见`kango-\docs\接口规范.md`。
